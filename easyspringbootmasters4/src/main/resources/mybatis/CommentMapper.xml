<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 配置命名空间 -->
<mapper namespace="com.ray.mapper.CommentMapper"> 
<!-- sql片段 -->
	<sql id="cmt">comment_id,
		content,
		create_time,
		course_no,
		user_no,
		comment_type
	</sql>

	<resultMap type="com.ray.entity.User" id="userRM">
		<!-- 主键 -->
		<id property="userNo" column="user_no"/>
		<!-- 普通 -->
		<result property="userName" column="user_name"/>
		<result property="userPwd"  column="user_pwd"/>
		<result property="maxScore" column="max_score"/>
		<!-- 对象映射 -->
		<association property="role" javaType="com.ray.entity.Role">
			<!-- 主键 -->
			<id property="roleId" column="role_id"/>
			<result property="roleName" column="role_name"/>
		</association>
	</resultMap>
	
    <resultMap type="com.ray.entity.Course" id="courseRM">
        <!-- 主键映射 -->
        <id property="courseNo" column="course_no"/>

        <!-- 普通字段 property指实体的属性；column结果集的字段名称 -->
        <result property="courseName" column="course_name"/>
        <result property="courseHours" column="course_hours"/>
        <result property="courseStatus" column="course_status"/>
        <result property="reqs" column="course_reqs"/>
        <result property="coursePoint" column="course_point"/>
        <result property="courseMemo" column="course_memo"/>
        <result property="courseTextbookPic" column="course_textbook_pic"/>


        <!-- 对象关联 -->
        <!-- 对一关系 -->
        <association property="courseType" javaType="com.ray.entity.CourseType">
            <!-- 主键映射 -->
            <id property="typeId" column="type_id"/>

            <!-- 普通字段 property指实体的属性；column结果集的字段名称 -->
            <result property="typeName" column="type_name"/>
        </association>

    </resultMap>
	
	<resultMap type="com.ray.entity.Comment" id="commentRM">
		<!-- 主键 -->
		<id property="commentId" column="comment_id"/>
		<!-- 普通 -->
		<result property="content" column="content"/>
		<result property="createTime"  column="create_time"/>
		<result property="commentType" column="comment_type"/>
		<!-- 对象映射 -->
		<association property="course" javaType="com.ray.entity.Course" resultMap="courseRM"/>
		<association property="user" javaType="com.ray.entity.User" resultMap="userRM"/>
	</resultMap>
	
	<!-- 增 -->
	<insert id="addComment" parameterType="com.ray.entity.Comment">
        insert into tbl_comments
        (<include refid="cmt"/>)
        values
        (#{commentId},#{content},#{createTime},#{course.courseNo},#{user.userNo},#{commentType})
    </insert>
    
    <!-- 删1 -->
    <delete id="removeCommentById" parameterType="int">
        delete from tbl_comments
        where comment_id = #{commentId}
    </delete>
    <!-- 删2 -->
    <delete id="removeCommentByCourseNo" parameterType="string">
        delete from tbl_comments
        where course_no = #{courseNo}
    </delete>
    
    <!--改 -->
    <update id="updateComment" parameterType="com.ray.entity.Comment" >
        update tbl_comments
        <set>
            <if test="content!=null">content=#{content},</if>
            <if test="commentType!=null">comment_type=#{commentType},</if>
        </set>
        where comment_id = #{commentId}
    </update>
    
    <select id="loadCommentById" parameterType="int" resultMap="commentRM">
        select * from tbl_comments
        where comment_id= #{commentId}
    </select>
    
    <!-- 根据courseId查询 -->
    <select id="loadCommentByCourseNo" parameterType="string" resultMap="commentRM">
        select * from tbl_comments
        where course_no= #{courseNo}
    </select>
</mapper>